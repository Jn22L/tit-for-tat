<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" content="notranslate" />
    <script src="/socket.io/tit-for-tat/socket.io.js"></script>
    <style>
      html,
      body {
        margin: 0;
        width: 100vw;
        height: 100vh;
        font-family: Source Code Pro, sourcecodepro, se-sourcecodepro, Consolas, Monaco, Andale Mono, Ubuntu Mono, monospace, sans-serif;
        font-size: 14px;
      }
      .titfortat-login {
        background-color: #ca9b52;
      }

      .titfortat-game {
        display: grid;
        grid-template-columns: 1fr;
        grid-template-rows: 3fr 4fr 3fr 3fr 2fr 2fr 150px;
        grid-template-areas:
          "your"
          "playground"
          "my"
          "control "
          "others"
          "etc"
          "score";
      }
      #div-join-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #div-login-info-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #div-your-wrapper {
        grid-area: your;
        background-color: #ffcc80;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        font-size: 32px;
      }
      #div-playground-wrapper {
        grid-area: playground;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }
      #div-playground-your {
        text-align: center;
      }
      #div-playground-center {
        text-align: center;
        font-size: 32px;
      }
      #div-playground-my {
        text-align: center;
      }
      #btn-playground-enter-game {
        height: 100%;
      }
      #div-my-wrapper {
        grid-area: my;
        background-color: #ffcc80;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        font-size: 32px;
      }
      #div-control-buttons-wrapper {
        grid-area: control;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
      }
      #btn-my-o {
        flex-grow: 1;
        height: 100%;
      }
      #btn-my-x {
        flex-grow: 1;
        height: 100%;
      }
      #div-others-wrapper {
        grid-area: others;
        display: flex;
        font-size: 20px;
      }
      #div-etc-wrapper {
        grid-area: etc;
        background-color: white;
        display: flex;
        font-size: 20px;
      }
      #div-score-wrapper {
        grid-area: score;
        overflow: auto;
        font-size: 20px;
      }
      ul {
        list-style: none;
        padding-left: 0px;
      }
      .titfortat-game button {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
      }
    </style>
    <title>Tit-for-Tab Game</title>
  </head>
  <body>
    <div class="titfortat-login">
      <div id="div-join-wrapper">
        <div>Tit-for-Tat Game</div>
        <div><input id="input-join" style="width: 100px" maxlength="8" autocomplete="off" /><button id="btn-join">Join</button></div>
      </div>
      <div id="div-login-info-wrapper"></div>
    </div>
    <div class="titfortat-game">
      <div id="div-your-wrapper">
        <div id="div-your-id"></div>
        <div id="div-your-status"></div>
      </div>
      <div id="div-playground-wrapper">
        <button id="btn-playground-enter-game">ê²Œì„í•˜ê¸°</button>
        <div id="div-playground-your"></div>
        <div id="div-playground-center"></div>
        <div id="div-playground-my"></div>
      </div>
      <div id="div-my-wrapper">
        <div id="div-my-id"></div>
        <div id="div-my-status"></div>
      </div>
      <div id="div-control-buttons-wrapper">
        <button id="btn-my-o">í˜‘ë ¥</button>
        <button id="btn-my-x">ë°°ì‹ </button>
      </div>
      <div id="div-others-wrapper">
        <label>ê´€ì „ì:</label>
        <div id="div-etc-ids"></div>
      </div>
      <div id="div-etc-wrapper">
        <div id="div-etc-user-count"></div>
      </div>
      <div id="div-score-wrapper"><ul id="ul-score-list"></ul></div>
    </div>
    <script>
      //const socket = io();
      const socket = io.connect({ path: "/socket.io/tit-for-tat/", transports: ["websocket"] });

      let tempLoginId; // ë¡œê·¸ì¸ ì‹œë„ ID

      let loginUserList = []; // ë¡œê·¸ì¸ ìœ ì €ëª©ë¡(ë¹„ë¡œê·¸ì¸ ì œì™¸) [{playerNo:1 , nickName:""}]
      let myInfo = { isLoginOk: false, isPlayer: false, nickName: "", playerNo: 0 };
      let player1Info = { nickName: "", playerNo: 1 };
      let player2Info = { nickName: "", playerNo: 2 };
      let playResultInfo = { round: 1, nextRound: 1, isP1End: false, p1Choice: "", p1Score: 0, p1TotScore: 0, isP2End: false, p2Choice: "", p2Score: 0, p2TotScore: 0 }; // ê°œë³„ì„ íƒì·¨í•©ê²°ê³¼
      let logoutPlayerNoDuringGame = 0; // ê²Œì„ë„ì¤‘ logout ì„ ìˆ˜ë²ˆí˜¸
      let isGameStart = false;

      const divJoinWrapper = document.querySelector("#div-join-wrapper");
      const inputJoin = document.querySelector("#input-join");
      const btnJoin = document.querySelector("#btn-join");
      const divLoginInfoWrapper = document.querySelector("#div-login-info-wrapper");

      const divYourWrapper = document.querySelector("#div-your-wrapper");
      const divYourId = document.querySelector("#div-your-id");

      const divPlaygroundWrapper = document.querySelector("#div-playground-wrapper");
      const btnPlaygroundEnterGame = document.querySelector("#btn-playground-enter-game");
      const divPlaygroundYour = document.querySelector("#div-playground-your");
      const divPlaygroundCenter = document.querySelector("#div-playground-center");
      const divPlaygroundMy = document.querySelector("#div-playground-my");

      const divMyWrapper = document.querySelector("#div-my-wrapper");
      const divMyId = document.querySelector("#div-my-id");
      const btnMyO = document.querySelector("#btn-my-o");
      const btnMyX = document.querySelector("#btn-my-x");

      const divEtcWrapper = document.querySelector("#div-etc-wrapper");
      const divEtcIds = document.querySelector("#div-etc-ids");
      const divEtcUserCount = document.querySelector("#div-etc-user-count");

      /************************************************************************
       * Local Event List
       ***********************************************************************/
      // ë‹‰ë„¤ì„ ì—”í„°
      inputJoin.addEventListener("keyup", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          btnJoin.click();
        }
      });

      // ë¡œê·¸ì¸ í´ë¦­
      btnJoin.addEventListener("click", function (e) {
        if (inputJoin.value.trim() === "" || inputJoin.value == null) {
          alert("please enter name");
          inputJoin.focus();
          return;
        }

        if (checkSpace(inputJoin.value)) {
          alert("ê³µë°±ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          inputJoin.focus();
          return;
        }

        if (!checkKor(inputJoin.value) && !checkEng(inputJoin.value) && !checkNum(inputJoin.value)) {
          alert("í•œê¸€/ì˜ë¬¸/ìˆ«ìë§Œ ì‚¬ìš©ê°€ëŠ¥í•©ë‹ˆë‹¤.");
          inputJoin.focus();
          return;
        }

        if (getByteLengthOfUtf8String(inputJoin.value) > 12) {
          alert("í•œê¸€4ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
          inputJoin.focus();
          return;
        }

        https: tempLoginId = inputJoin.value;
        socket.emit("join user", tempLoginId);
      });

      // ê²Œì„ì°¸ì—¬ í´ë¦­
      btnPlaygroundEnterGame.addEventListener("click", function (e) {
        if (!myInfo.isLoginOk) {
          alert("not login user");
          return;
        }
        if (myInfo.isPlayer) {
          alert("already in the game");
          return;
        }
        socket.emit("enter game", myInfo.nickName);
      });

      // ê²Œì„ì§„í–‰:O í´ë¦­
      btnMyO.addEventListener("click", function (e) {
        if (!myInfo.isLoginOk) {
          alert("not login user");
          return;
        }
        if (!myInfo.isPlayer) {
          alert("you are not a player");
          return;
        }

        divPlaygroundMy.innerHTML = "í˜‘ë ¥";

        let nextRound = playResultInfo.nextRound; // ë‘˜ë‹¤ì„ íƒì‹œ ì„œë²„ì—ì„œ ë¼ìš´ë“œ + 1
        socket.emit("play game", { round: nextRound, nickName: myInfo.nickName, playerNo: myInfo.playerNo, choice: "O" });
        btnMyO.disabled = true;
        btnMyX.disabled = true;
      });

      // ê²Œì„ì§„í–‰:X í´ë¦­
      btnMyX.addEventListener("click", function (e) {
        if (!myInfo.isLoginOk) {
          alert("not login user");
          return;
        }
        if (!myInfo.isPlayer) {
          alert("you are not a player");
          return;
        }

        divPlaygroundMy.innerHTML = "ë°°ì‹ ";

        let nextRound = playResultInfo.nextRound; // ë‘˜ë‹¤ì„ íƒì‹œ ì„œë²„ì—ì„œ ë¼ìš´ë“œ + 1
        socket.emit("play game", { round: nextRound, nickName: myInfo.nickName, playerNo: myInfo.playerNo, choice: "X" });
        btnMyO.disabled = true;
        btnMyX.disabled = true;
      });

      /************************************************************************
       * Server Event List
       ***********************************************************************/
      // ë¹„ë¡œê·¸ì¸ ì ‘ì†
      socket.on("connect user", function (serverMsg) {
        inputJoin.focus();
        renderPlayerLayout(serverMsg.loginUserList);
        renderUserCount(serverMsg); // ì ‘ì†ìœ ì €ìˆ˜
      });

      // ë¡œê·¸ ì•„ì›ƒ - ì„ ìˆ˜ê°€ ë¡œê·¸ì•„ì›ƒí•˜ë©´ ê²Œì„ ë¹„ì •ìƒì¢…ë£Œ
      socket.on("user logout", function (serverMsg) {
        if (serverMsg.logoutUser.playerNo === 1 || serverMsg.logoutUser.playerNo === 2) {
          // ì„ ìˆ˜í‡´ì¥ì‹œ - ê²Œì„ ë¹„ì •ìƒ ì¢…ë£Œ
          playResultInfo = serverMsg.playResultInfo; // ê²Œì„ê²°ê³¼ìˆ˜ì‹ 
          logoutPlayerNoDuringGame = serverMsg.logoutUser.playerNo;
          renderScore(); // ì ìˆ˜ê³„ì‚°
          logoutPlayerNoDuringGame = 0;
          playResultInfo.nextRound = 1;
        }

        renderPlayerLayout(serverMsg.loginUserList);
        renderUserCount(serverMsg); // ì ‘ì†ìœ ì €ìˆ˜
      });

      // ë¡œê·¸ì¸
      socket.on("join user", function (serverMsg) {
        /*----- ë‹‰ë„¤ì„ ì¤‘ë³µì²´í¬ -----*/
        if (tempLoginId === serverMsg.nickName) {
          if (serverMsg.isLoginOk) {
            // ì •ìƒ
            divJoinWrapper.setAttribute("style", "display:none;");
            divLoginInfoWrapper.innerHTML = `<div>Tit-for-Tat Game</div><div>${serverMsg.nickName}</div> `;
            myInfo.isLoginOk = serverMsg.isLoginOk;
            myInfo.isPlayer = false;
            myInfo.nickName = serverMsg.nickName;
            myInfo.playerNo = serverMsg.playerNo;
            tempLoginId = null;
          } else {
            // ì¤‘ë³µ
            divJoinWrapper.setAttribute("style", "display:block;");
            divLoginInfoWrapper.innerHTML = "";
            alert(tempLoginId + "(ì€/ëŠ”) ì´ë¯¸ ì‚¬ìš©ì¤‘ì¸ ì´ë¦„ ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.");
            inputJoin.value = "";
            return;
          }
        }

        if (!serverMsg.isLoginOk) return; // ë¡œê·¸ì¸ ì‹¤íŒ¨ê±´ return : í™”ë©´ë³€ê²½ì—†ìŒ

        /*----- ë¡œê·¸ì¸ ì„±ê³µì‹œ ì •ìƒì§„í–‰ -----*/
        renderPlayerLayout(serverMsg.loginUserList); // í™”ë©´ë³€ê²½:ì„ ìˆ˜ë°°ì¹˜
        renderUserCount(serverMsg); // ì ‘ì†ìœ ì €ìˆ˜ í‘œì‹œ
      });

      // ê²Œì„ ì°¸ì—¬
      socket.on("enter game", function (serverMsg) {
        if (myInfo.nickName === serverMsg.nickName) {
          if (serverMsg.isPlayer) {
            myInfo.isPlayer = true;
            myInfo.playerNo = serverMsg.playerNo;
            //alert("Success to join the game.");
          } else {
            myInfo.isPlayer = false;
            myInfo.playerNo = serverMsg.playerNo;
            alert("Fail to join the game.");
          }
        }
        renderPlayerLayout(serverMsg.loginUserList); // ì„ ìˆ˜ë°°ì¹˜(ì„ ìˆ˜1,ì„ ìˆ˜2,ê´€ì „ëª©ë¡) rendering
      });

      // ê²Œì„ì§„í–‰
      socket.on("play game", function (serverMsg) {
        playResultInfo = serverMsg; // ê²Œì„ê²°ê³¼ìˆ˜ì‹ 

        // ë¼ìš´ë“œ ì§„í–‰ì‹œ(1ì‚¬ëŒë§Œ ì„ íƒì‹œ)
        if (playResultInfo.round === playResultInfo.nextRound) {
          if (myInfo.isPlayer) {
            // ì„ ìˆ˜ì¼ë•Œ, 'ì„ íƒì™„ë£Œ'ë¡œ í‘œì‹œ
            if ((myInfo.playerNo === 1 && playResultInfo.isP2End) || (myInfo.playerNo === 2 && playResultInfo.isP1End)) {
              divPlaygroundYour.innerHTML = `<span style="color:red;">ìƒëŒ€ì„ íƒì™„ë£Œ</span>`;
            }
          } else {
            // ê´€ì „ì¼ë•Œ, ì‹¤ì œì„ íƒ ë°ì´íƒ€ í‘œì‹œ
            if (playResultInfo.p1Choice === "O") {
              divPlaygroundYour.innerHTML = `<span style="color:red;">í˜‘ë ¥</span>`;
            } else if (playResultInfo.p1Choice === "X") {
              divPlaygroundYour.innerHTML = `<span style="color:red;">ë°°ì‹ </span>`;
            }
            if (playResultInfo.p2Choice === "O") {
              divPlaygroundMy.innerHTML = `<span style="color:red;">í˜‘ë ¥</span>`;
            } else if (playResultInfo.p2Choice === "X") {
              divPlaygroundMy.innerHTML = `<span style="color:red;">ë°°ì‹ </span>`;
            }
          }
        } else if (playResultInfo.round < playResultInfo.nextRound) {
          // ë¼ìš´ë“œ ì¢…ë£Œì‹œ

          renderScore(); // ì ìˆ˜í‘œì‹œ

          // 3ì´ˆí›„ ë‹¤ìŒë¼ìš´ë“œ ì§„í–‰í‘œì‹œ
          let timer3 = 3;
          let timer3Id = setInterval(function () {
            divPlaygroundCenter.innerHTML = `<span style='color:red'>${timer3}</span>ì´ˆí›„ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.`;
            timer3--;
            if (timer3 < 0) {
              clearInterval(timer3Id);
              if (myInfo.isPlayer) {
                divPlaygroundYour.innerHTML = `í˜‘/í˜‘:3/3,ë°°/ë°°:1/1,ë°°/í˜‘:5/0`;
                divPlaygroundMy.innerHTML = `<span style="color:#EA4335">[í˜‘ë ¥] ë˜ëŠ” [ë°°ì‹ ]ì„ ì„ íƒí•˜ì„¸ìš”`;
              } else {
                divPlaygroundYour.innerHTML = `í˜‘/í˜‘:3/3,ë°°/ë°°:1/1,ë°°/í˜‘:5/0`;
                divPlaygroundMy.innerHTML = `<span style="color:#EA4335">[í˜‘ë ¥] ë˜ëŠ” [ë°°ì‹ ]ì„ ì„ íƒí•˜ì„¸ìš”`;
              }

              divPlaygroundCenter.innerHTML = `Round ${playResultInfo.nextRound}`;
              // ì„ ìˆ˜ë§Œ ë²„íŠ¼ í™œì„±
              if (myInfo.isPlayer) {
                btnMyO.disabled = false;
                btnMyX.disabled = false;
              }
            }
          }, 1000);
        } else if (playResultInfo.nextRound === -1) {
          // ê²Œì„ ì •ìƒì¢…ë£Œì‹œ
          renderScore(); // ì ìˆ˜í‘œì‹œ
          playResultInfo.nextRound = 1;
        }
      });

      // ê²Œì„ì¢…ë£Œí›„ íŒ¨ì/ë™ì ì ëŒ€ê¸°ì‹¤ ì´ë™
      socket.on("go waiting room", function (serverMsg) {
        console.log("go waiting room", serverMsg);
        console.log("go waiting room 222", serverMsg.loginUserList);
        serverMsg.forEach(function (elm) {
          console.log("ë‚˜ì˜ player 998 ì…‹íŒ…", elm);
          if (myInfo.nickName === elm.nickName) {
            console.log("ë‚˜ì˜ player 998 ì…‹íŒ…");
            myInfo.playerNo = elm.playerNo; // 998 ì…‹íŒ…
          }
        });
        renderPlayerLayout(serverMsg); // ì„ ìˆ˜ë°°ì¹˜(ì„ ìˆ˜1,ì„ ìˆ˜2,ê´€ì „ëª©ë¡) rendering
      });

      /************************************************************************
       * function list
       ***********************************************************************/
      // UTF8 ìë¦¿ìˆ˜ ê³„ì‚°
      function getByteLengthOfUtf8String(s) {
        if (s != undefined && s != "") {
          for (b = i = 0; (c = s.charCodeAt(i++)); b += c >> 11 ? 3 : c >> 7 ? 2 : 1);
          return b;
        } else {
          return 0;
        }
      }
      // ì˜ë¬¸(ì˜ì–´) ì²´í¬
      function checkEng(str) {
        const regExp = /[a-zA-Z]/g; // ì˜ì–´
        if (regExp.test(str)) {
          return true;
        } else {
          return false;
        }
      }

      // í•œê¸€ ì²´í¬
      function checkKor(str) {
        const regExp = /[ã„±-ã…ã…-ã…£ê°€-í£]/g;
        if (regExp.test(str)) {
          return true;
        } else {
          return false;
        }
      }

      // ìˆ«ì ì²´í¬
      function checkNum(str) {
        const regExp = /[0-9]/g;
        if (regExp.test(str)) {
          return true;
        } else {
          return false;
        }
      }

      // ê³µë°±(ìŠ¤í˜ì´ìŠ¤ ë°”) ì²´í¬
      function checkSpace(str) {
        if (str.search(/\s/) !== -1) {
          return true; // ìŠ¤í˜ì´ìŠ¤ê°€ ìˆëŠ” ê²½ìš°
        } else {
          return false; // ìŠ¤í˜ì´ìŠ¤ ì—†ëŠ” ê²½ìš°
        }
      }

      /**
       * ì„ ìˆ˜ë°°ì¹˜(ì„ ìˆ˜1,ì„ ìˆ˜2,ê´€ì „ëª©ë¡) rendering
       * @param pLoginUserList: ë¡œê·¸ì¸ ìœ ì €ëª©ë¡
       * @return
       */
      function renderPlayerLayout(pLoginUserList) {
        /* glable setting list
                 - data
                 loginUserList // ë¡œê·¸ì¸í•œ ì „ì²´ìœ ì € ëª©ë¡
                 player1Info       // player1 ì •ë³´
                 player2Info       // player2 ì •ë³´

                 - screen
                 divYourWrapper       // ìƒëŒ€ì •ë³´ í‘œì‹œ
                 divPlaygroundWrapper // ê²½ê¸°ì¥
                 divMyWrapper         // ë‚´ì •ë³´ í‘œì‹œ
                 divEtcWrapper        // ê´€ì „ ë° ê¸°íƒ€ì •ë³´ í‘œì‹œ
              */
        player1Info = {};
        player2Info = {};
        loginUserList = pLoginUserList;
        loginUserList.forEach(function (elm) {
          if (elm.playerNo === 1) {
            player1Info = elm;
          } else if (elm.playerNo === 2) {
            player2Info = elm;
          }
        });

        console.log("renderPlayerLayout:myInfo", myInfo);
        console.log("renderPlayerLayout:player1Info", player1Info);
        console.log("renderPlayerLayout:player2Info", player2Info);
        // ì„ ìˆ˜ë°°ì¹˜
        if (myInfo.playerNo === 1) {
          // ë‚´ê°€ 1ë²ˆ ì„ ìˆ˜ì¼ë•Œ
          if (player2Info.nickName !== undefined) {
            divYourId.innerHTML = player2Info.nickName || "ê²Œì„ ëŒ€ê¸°ì¤‘";
          }
          divMyId.innerHTML = myInfo.nickName;
        } else if (myInfo.playerNo === 2) {
          // ë‚´ê°€ 2ë²ˆ ì„ ìˆ˜ì¼ë•Œ
          if (player1Info.nickName !== undefined) {
            divYourId.innerHTML = player1Info.nickName || "ê²Œì„ ëŒ€ê¸°ì¤‘";
          }
          divMyId.innerHTML = myInfo.nickName;
        } else {
          // ë‚´ê°€ ê´€ì „ì¼ë•Œ
          // --- ê²Œì„ì°¸ì—¬í›„ íŒ¨ë°°ë¡œ ê´€ì „ì‹œ, ì´ì „ì°¸ì—¬ìë¥¼ ê·¸ëŒ€ë¡œ í™”ë©´ì— ë‚¨ê²¨ë‘ 
          if (myInfo.playerNo !== 998) {
            divYourId.innerHTML = player1Info.nickName || "ê²Œì„ ëŒ€ê¸°ì¤‘";
            divMyId.innerHTML = player2Info.nickName || "ê²Œì„ ëŒ€ê¸°ì¤‘";
          }
        }

        // ì„ ìˆ˜ë°°ì¹˜ ì™„ë£Œì‹œ
        if (player1Info.nickName !== undefined && player2Info.nickName !== undefined) {
          // ê²Œì„ì°¸ì—¬ ë²„íŠ¼ ê°ì¶”ê³ , ì´ì  í‘œì‹œ ì´ˆê¸°í™”
          // ê²Œì„ì‹œì‘ì‹œ 1ë²ˆ ë Œë”ë§
          if (!isGameStart && playResultInfo.nextRound === 1) {
            isGameStart = true;

            btnPlaygroundEnterGame.setAttribute("style", "display:none;");
            document.querySelector("#div-your-status").innerHTML = "";
            document.querySelector("#div-my-status").innerHTML = "";

            // 3ì´ˆí›„ ë‹¤ìŒë¼ìš´ë“œ ì§„í–‰í‘œì‹œ
            let timer3 = 3;
            let timer3Id = setInterval(function () {
              divPlaygroundCenter.innerHTML = `<span style='color:red'>${timer3}</span>ì´ˆí›„ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.`;
              timer3--;
              if (timer3 < 0) {
                clearInterval(timer3Id);
                if (myInfo.isPlayer) {
                  divPlaygroundYour.innerHTML = "í˜‘/í˜‘:3/3,ë°°/ë°°:1/1,ë°°/í˜‘:5/0";
                  divPlaygroundMy.innerHTML = `<span style="color:#EA4335">[í˜‘ë ¥] ë˜ëŠ” [ë°°ì‹ ]ì„ ì„ íƒí•˜ì„¸ìš”`;
                } else {
                  divPlaygroundYour.innerHTML = "í˜‘/í˜‘:3/3,ë°°/ë°°:1/1,ë°°/í˜‘:5/0";
                  divPlaygroundMy.innerHTML = `<span style="color:#EA4335">[í˜‘ë ¥] ë˜ëŠ” [ë°°ì‹ ]ì„ ì„ íƒí•˜ì„¸ìš”`;
                }
                divPlaygroundCenter.innerHTML = `Round ${playResultInfo.nextRound}`;
                // ì„ ìˆ˜ë§Œ ë²„íŠ¼ í™œì„±
                if (myInfo.isPlayer) {
                  btnMyO.disabled = false;
                  btnMyX.disabled = false;
                }
              }
            }, 1000);
          }
        } else {
          // ì„ ìˆ˜ë°°ì¹˜ ë¯¸ì™„ë£Œì‹œ - ê²Œì„ì°¸ì—¬ ë²„íŠ¼ ë³´ì´ê³ , O/X ë²„íŠ¼ disable
          if (myInfo.isPlayer) {
            // ë‚˜ë§Œ ì°¸ì—¬ì¤‘ì¼ë•Œ, ê²Œì„ì°¸ì—¬ ë²„íŠ¼ ê°ì¶”ê¸°
            btnPlaygroundEnterGame.setAttribute("style", "display:none;");
          } else {
            btnPlaygroundEnterGame.setAttribute("style", "display:inline-block;");
          }
          btnMyO.disabled = true;
          btnMyX.disabled = true;
        }

        // ê´€ì „ëª©ë¡(í•­ìƒê°±ì‹ )
        divEtcIds.innerHTML = "";
        loginUserList.forEach((elm) => {
          if (elm.playerNo > 2) {
            divEtcIds.insertAdjacentHTML("afterbegin", elm.nickName + " ");
          }
        });

        // ë¹„ë¡œê·¸ì¸ ë²„íŠ¼ ë¹„í™œì„±
        if (!myInfo.isLoginOk) {
          btnMyO.disabled = true;
          btnMyX.disabled = true;
        }
      }

      /**
       * ì ‘ì†ìœ ì €ìˆ˜ í‘œì‹œ
       * @param object: { allUserCount: ë¹„ë¡œê·¸ì¸í¬í•¨ ì „ì²´ìœ ì €ìˆ˜, loginUserList: ë¡œê·¸ì¸ ìœ ì €ëª©ë¡ []  }
       * @return
       */
      function renderUserCount(serverMsg) {
        divEtcUserCount.innerHTML = `All:${serverMsg.allUserCount} ë¡œê·¸ì¸:${serverMsg.loginUserList.length} ë¹„ë¡œê·¸ì¸:${serverMsg.allUserCount - serverMsg.loginUserList.length}`;
      }

      /**
       * ì ìˆ˜ í‘œì‹œ
       * @param
       * @return
       */
      function renderScore() {
        let browserWidth = window.innerWidth;

        let ulScoreList = document.querySelector("#ul-score-list");
        let divYourStatus = document.querySelector("#div-your-status");
        let divMyStatus = document.querySelector("#div-my-status");

        if (browserWidth < 768) {
          /* mobile ì ìˆ˜í‘œì‹œ - 768px ë¯¸ë§Œ */

          if (myInfo.playerNo === 1) {
            // ë‚´ê°€ 1ë²ˆ ì„ ìˆ˜ì¼ë•Œ
            divYourStatus.innerHTML = `ì ìˆ˜ : <span style="color:red;">${playResultInfo.p2TotScore}</span>`;
            divPlaygroundYour.innerHTML = `<span style="color:red;">${playResultInfo.p2Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p2Score}</span>`;
            divPlaygroundMy.innerHTML = `<span style="color:red;">${playResultInfo.p1Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p1Score}</span>`;
            divMyStatus.innerHTML = `ì ìˆ˜ : <span style="color:red;">${playResultInfo.p1TotScore}</span>`;
          } else if (myInfo.playerNo === 2) {
            // ë‚´ê°€ 2ë²ˆ ì„ ìˆ˜ì¼ë•Œ
            divYourStatus.innerHTML = `ì ìˆ˜ : <span style="color:red;">${playResultInfo.p1TotScore}</span>`;
            divPlaygroundYour.innerHTML = `<span style="color:red;">${playResultInfo.p1Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p1Score}</span>`;
            divPlaygroundMy.innerHTML = `<span style="color:red;">${playResultInfo.p2Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p2Score}</span>`;
            divMyStatus.innerHTML = `ì ìˆ˜ : <span style="color:red;">${playResultInfo.p2TotScore}</span>`;
          } else {
            // ë‚´ê°€ ê´€ì „ì¼ë•Œ
            divYourStatus.innerHTML = `ì ìˆ˜ : <span style="color:red;">${playResultInfo.p1TotScore}</span>`;
            divPlaygroundYour.innerHTML = `<span style="color:red;">${playResultInfo.p1Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p1Score}</span>`;
            divPlaygroundMy.innerHTML = `<span style="color:red;">${playResultInfo.p2Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p2Score}</span>`;
            divMyStatus.innerHTML = `ì ìˆ˜ : <span style="color:red;">${playResultInfo.p2TotScore}</span>`;
          }

          if (!logoutPlayerNoDuringGame) {
            // ê¸°ê¶ŒìŠ¹ì´ ì•„ë‹ë•Œ
            rounScoreStr = `R${playResultInfo.round}:${playResultInfo.p1NickName} ${playResultInfo.p1Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "} ${playResultInfo.p1Score} - ${playResultInfo.p2NickName} ${
              playResultInfo.p2Choice === "O" ? "í˜‘ë ¥" : "ë°°ì‹ "
            } ${playResultInfo.p2Score}`;
            let liScoreTemp = document.createElement("li");
            liScoreTemp.innerHTML = rounScoreStr;
            ulScoreList.insertAdjacentElement("afterbegin", liScoreTemp); // ëª¨ë°”ì¼ì€ descending í‘œê¸°
          }

          //ì •ìƒ ê²Œì„ì¢…ë£Œì‹œ - ë¼ìš´ë“œ end
          if (playResultInfo.nextRound === -1) {
            isGameStart = false;
            if (myInfo.playerNo === 1) {
              // ë‚´ê°€ 1ë²ˆ ì„ ìˆ˜ì¼ë•Œ
              divPlaygroundYour.innerHTML = `GAME OVER`;
              if (playResultInfo.p1TotScore > playResultInfo.p2TotScore) {
                divPlaygroundCenter.innerHTML = `YOU WIN!ğŸ‘ğŸ‘ğŸ‘`;
                divPlaygroundMy.innerHTML = `Winner => Game Continue`;
              } else if (playResultInfo.p1TotScore < playResultInfo.p2TotScore) {
                divPlaygroundCenter.innerHTML = `YOU LOSE!ğŸ‘ğŸ‘ğŸ‘`;
                divPlaygroundMy.innerHTML = `Loser => go waiting room`;
                myInfo.isPlayer = false;
                myInfo.playerNo = 999;
                socket.emit("go waiting room", { isPlayNo1GoWaitingRoom: true, isPlayNo2GoWaitingRoom: false });
              } else {
                divPlaygroundCenter.innerHTML = `DRAW!`;
                divPlaygroundMy.innerHTML = `Draw => go waiting room`;
                myInfo.isPlayer = false;
                myInfo.playerNo = 999;
                socket.emit("go waiting room", { isPlayNo1GoWaitingRoom: true, isPlayNo2GoWaitingRoom: true });
              }
            } else if (myInfo.playerNo === 2) {
              // ë‚´ê°€ 2ë²ˆ ì„ ìˆ˜ì¼ë•Œ
              divPlaygroundYour.innerHTML = `GAME OVER`;
              if (playResultInfo.p2TotScore > playResultInfo.p1TotScore) {
                divPlaygroundCenter.innerHTML = `YOU WIN!ğŸ‘ğŸ‘ğŸ‘`;
                divPlaygroundMy.innerHTML = `Winner => Game Continue`;
              } else if (playResultInfo.p2TotScore < playResultInfo.p1TotScore) {
                divPlaygroundCenter.innerHTML = `YOU LOSE!ğŸ‘ğŸ‘ğŸ‘`;
                divPlaygroundMy.innerHTML = `Loser => go waiting room`;
                myInfo.isPlayer = false;
                myInfo.playerNo = 999;
                socket.emit("go waiting room", { isPlayNo1GoWaitingRoom: false, isPlayNo2GoWaitingRoom: true });
              } else {
                divPlaygroundCenter.innerHTML = `DRAW!`;
                divPlaygroundMy.innerHTML = `Draw => go waiting room`;
                myInfo.isPlayer = false;
                myInfo.playerNo = 999;
                socket.emit("go waiting room", { isPlayNo1GoWaitingRoom: true, isPlayNo2GoWaitingRoom: true });
              }
            } else {
              // ë‚´ê°€ ê´€ì „ì¼ë•Œ
              divPlaygroundYour.innerHTML = `GAME OVER`;
              if (playResultInfo.p2TotScore > playResultInfo.p1TotScore) {
                divPlaygroundCenter.innerHTML = `${player2Info.nickName} WIN!ğŸ‘ğŸ‘ğŸ‘`;
                divPlaygroundMy.innerHTML = `Winner=>Game/Losor=>WaitingRoom`;
              } else if (playResultInfo.p2TotScore < playResultInfo.p1TotScore) {
                divPlaygroundCenter.innerHTML = `${player1Info.nickName} WIN!ğŸ‘ğŸ‘ğŸ‘`;
                divPlaygroundMy.innerHTML = `Winner=>Game/Losor=>WaitingRoom`;
              } else {
                divPlaygroundCenter.innerHTML = `DRAW!`;
                divPlaygroundMy.innerHTML = `Winner=>Game/Losor=>WaitingRoom`;
              }
            }

            rounScoreStr = `R${playResultInfo.round}End:${playResultInfo.p1NickName} ${playResultInfo.p1TotScore} - ${playResultInfo.p2NickName} ${playResultInfo.p2TotScore}`;
            let liScoreTemp = document.createElement("li");
            liScoreTemp.innerHTML = rounScoreStr;
            ulScoreList.insertAdjacentElement("afterbegin", liScoreTemp); // ëª¨ë°”ì¼ì€ descending í‘œê¸°
          } else if (playResultInfo.nextRound === -2) {
            // ë¹„ì •ìƒ ê²Œì„ì¢…ë£Œì‹œ - ì„ ìˆ˜logout
            if (isGameStart) {
              isGameStart = false;
              if (myInfo.isPlayer) {
                // ë‚¨ì€ ì„ ìˆ˜ì¼ë•Œ
                divPlaygroundYour.innerHTML = `GAME OVER`;
                divPlaygroundCenter.innerHTML = `YOU WIN (ê¸°ê¶ŒìŠ¹) !`;
                divPlaygroundMy.innerHTML = `ğŸ‘ğŸ‘ğŸ‘`;
              } else {
                // ë‚´ê°€ ê´€ì „ì¼ë•Œ
                if (logoutPlayerNoDuringGame === 1) {
                  // ë‚˜ê°„ì„ ìˆ˜ê°€ 1ë²ˆì´ë©´ 2ë²ˆìŠ¹ë¦¬
                  divPlaygroundYour.innerHTML = `GAME OVER`;
                  divPlaygroundCenter.innerHTML = `${player2Info.nickName}WIN(ê¸°ê¶ŒìŠ¹)!`;
                  divPlaygroundMy.innerHTML = `ğŸ‘ğŸ‘ğŸ‘`;
                } else if (logoutPlayerNoDuringGame === 2) {
                  // ë‚˜ê°„ì„ ìˆ˜ê°€ 2ë²ˆì´ë©´ 1ë²ˆìŠ¹ë¦¬
                  divPlaygroundYour.innerHTML = `GAME OVER`;
                  divPlaygroundCenter.innerHTML = `${player1Info.nickName}WIN(ê¸°ê¶ŒìŠ¹)!`;
                  divPlaygroundMy.innerHTML = `ğŸ‘ğŸ‘ğŸ‘`;
                }
              }
            }
          }
        } else {
          /* desktop ì ìˆ˜í‘œì‹œ - 768px ì´ìƒ */

          if (playResultInfo.round > 1) {
            let ulLen = ulScoreList.children.length;
            let liLast = ulScoreList.children[ulLen - 1];
            let liLast2 = ulScoreList.children[ulLen - 2];
            let liLast3 = ulScoreList.children[ulLen - 3];

            ulScoreList.removeChild(liLast);
            ulScoreList.removeChild(liLast2);
            ulScoreList.removeChild(liLast3);
          }

          // round score
          let rounScoreStr = `R ${playResultInfo.round} ${playResultInfo.p1NickName} ${playResultInfo.p1Choice} ${playResultInfo.p1Score} - ${playResultInfo.p2NickName} ${playResultInfo.p2Choice} ${playResultInfo.p2Score}`;

          let liScoreTemp = document.createElement("li");
          liScoreTemp.innerHTML = rounScoreStr;
          ulScoreList.appendChild(liScoreTemp);

          // total score
          let totScoreStr = `Total ${playResultInfo.round}: ${playResultInfo.p1NickName}  ${playResultInfo.p1TotScore} - ${playResultInfo.p2NickName} ${playResultInfo.p2TotScore}`;

          let liTotalScoreTemp = document.createElement("li");
          liTotalScoreTemp.innerHTML = `-----------------------`;
          ulScoreList.appendChild(liTotalScoreTemp);
          let liTotalScoreTemp2 = document.createElement("li");
          liTotalScoreTemp2.innerHTML = totScoreStr;
          ulScoreList.appendChild(liTotalScoreTemp2);
          let liTotalScoreTemp3 = document.createElement("li");
          liTotalScoreTemp3.innerHTML = `-----------------------`;
          ulScoreList.appendChild(liTotalScoreTemp3);
        }
      }
    </script>
  </body>
</html>
